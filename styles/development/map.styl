_mapColor = hsl(16, 100%, 66%) // Coral

.map
  width: 100%
  min-width: 100% // @bugfix @affected Old browsers.
  min-height: 30em
  aspect-ratio: 9/16
  @media (orientation: landscape)
    aspect-ratio: 16/9
  margin: auto
  background-color: #e6e4e0 // Couleur en lien avec le background dominant des tuiles choisies pour les cartes Leaflet.
  overflow: hidden // Évite à l'occasion un débordement des tuiles. Solution imparfaite.

.map-grayscale .leaflet-layer
  filter: grayscale(1)

.map-dark .leaflet-layer
  filter: grayscale(1) invert(1) brightness(1.1) contrast(.7)

.map-vintage
  position: relative
  filter: sepia(1) // @note On ne peut pas appliquer de filtre SVG directement sur les tuiles, on passe par un pseudo-élément.
  &::before
  &::after
    content: ''
    position: absolute
    z-index: 500
    inset: 0
    pointer-events: none
  &::before
    background-image: radial-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, .5))
  &::after
    filter: url(../sprites/filter.svg#noise) sepia(1) opacity(.4)

//.leaflet-container
  //outline-color: _color5 !important

:root .map .leaflet-control
  border: none
  box-shadow: _shadow14

:root .map .leaflet-popup-content-wrapper
  font-size: 1rem // @note Unité rem obligatoire pour éviter les conflits sur la carte.
  color: #777
  border-radius: .2em
  box-shadow: _shadow14

.leaflet-popup-content
  max-width: calc(100vw - 6em)

.leaflet-popup-tip
  box-shadow: _shadow14

.leaflet-marker-icon
  outline: none // pour prévenir l'effet sur :focus et :hover

.leaflet-marker-icon
  &:focus-visible::after
    content: ''
    display: block
    box-sizing: border-box
    position: relative
    z-index: -1
    height: 4em
    width: 4em
    border: 1em solid rgba(255, 0, 0, .3)
    clip-path: polygon(45% 0%, 55% 0%, 55% 45%, 100% 45%, 100% 55%, 55% 55%, 55% 100%, 45% 100%, 45% 55%, 0% 55%, 0% 45%, 45% 45%)
    transform: translate(-.35em, -2.5em)
  &:focus .marker-icon
  &:hover .marker-icon
    animation: anim-bounce .35s ease infinite alternate

.start-map .marker-icon
  animation: anim-drop 1s ease

.marker-icon
  filter: drop-shadow(.3em .3em .3em rgba(0, 0, 0, .5))
  & > :first-child
    fill: var(--color, _mapColor)
  & > :last-child
    fill: #000
    opacity: .15

@keyframes anim-bounce
  to
    transform: translate(0, -16px)

@keyframes anim-drop
  0%
    transform: translate(0, -100vh)
  50%
    transform: translate(0, 0)
  75%
    transform: translate(0, -40px)
  100%
    transform: translate(0, 0)

//.leaflet-control-attribution
//  display: none
