async function generateIcsFile(){const e=JSON.parse(localStorage.getItem("scheduleData"))||{},t=new Date,a=new Date(t);a.setFullYear(a.getFullYear()+1);const n=t.getFullYear(),r=t.getMonth()+1,s={M:"Poste du matin",S:"Poste du soir",J:"Poste de journée",N:"Poste de nuit",H:"Heures supplémentaires",R:"Repos",T:"Réduction du temps de travail",F:"Repos férié",C:"Congé annuel",I:"Formation",A:"Arrêt de travail ou maladie",G:"Grève",D:"Décharge syndicale",X:"",Y:"",Z:""},o={M:"M",S:"S",J:"J",N:"N",H:"H sup",R:"R",T:"RTT",F:"RF",C:"CA",I:"Formation",A:"Maladie",G:"Grève",D:"D",X:"X",Y:"Y",Z:"Z"};let l="BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//ScripturaUA0//ICS Generator v1.0//FR\n";Object.keys(e).sort().forEach((i=>{const[c,d]=i.split("-").map(Number);if(c>n||c===n&&d>=r){const n=e[i];Object.entries(n).forEach((([e,n])=>{const r=new Date(c,d-1,parseInt(e));if(r>=t&&r<=a){const e=n[1];if(e){const a=o[e]||"",n=s[e]||"Poste inconnu",i=r.getFullYear(),c=(r.getMonth()+1).toString().padStart(2,"0"),d=r.getDate().toString().padStart(2,"0");l+=`\nBEGIN:VEVENT\nUID:event-${i}-${c}-${d}-${e}@UA0\nDTSTAMP:${formatDateToICS(t)}\nDTSTART:${i}${c}${d}\nDTEND:${i}${c}${d}\nSUMMARY:${a}\nDESCRIPTION:${n}\nEND:VEVENT`}}}))}})),l+="\nEND:VCALENDAR",await downloadFile(l,`schedule_${n}.ics`,"text/calendar")}function formatDateToICS(e){return e.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z"}async function downloadFile(e,t,a="application/octet-stream"){const n=new Blob([e],{type:a}),r=URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.download=t,s.click(),URL.revokeObjectURL(r)}async function registerServiceWorker(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("/app/UA0/sw.js");e.installing?console.log("Installation du service worker en cours"):e.waiting?console.log("Service worker installé"):e.active&&console.log("Service worker actif")}catch(e){console.error(`L'enregistrement du service worker a échoué : ${e}`)}}function textareaAutosize(e){const t=document.querySelectorAll(".target-for-textarea"),a=()=>{e.style.height="auto",e.style.height=`${e.scrollHeight}px`};window.addEventListener("load",a),window.addEventListener("resize",a),e.addEventListener("input",a),e.addEventListener("focus",a),t.forEach((e=>{e.addEventListener("change",a),e.addEventListener("click",(()=>{a(),setTimeout(a,1)}))}))}function updateDisabledState(){const e=null!==localStorage.getItem("scheduleData");document.querySelector("select#pattern-select").disabled=e,document.querySelector("input#start-date").disabled=e,document.querySelector("#generate-schedule").disabled=e,e&&document.querySelectorAll(".visibility").forEach((e=>{e.classList.add("visible"),e.classList.remove("hidden")}))}function updateYearInTitle(e){const t=(new Date).getFullYear(),a=document.getElementById(e);a?a.textContent=t:console.warn(`L'élément avec l'ID "${e}" est introuvable.`)}function strToDom(e){return document.createRange().createContextualFragment(e).firstChild}function easeOutExpo(e){return 1===e?1:1-Math.pow(2,-10*e)}document.getElementById("generate-ics").addEventListener("click",generateIcsFile),registerServiceWorker(),function(){const e=document.querySelectorAll(".cmd-print");for(const t of e)t.onclick=function(){window.print()}}(),document.querySelectorAll("textarea.autosize").forEach((e=>textareaAutosize(e))),document.addEventListener("DOMContentLoaded",(()=>{updateDisabledState()})),document.querySelector("#generate-schedule").addEventListener("click",(e=>{const t=document.querySelector("input#start-date");t.value?(document.querySelector("#generate-schedule").disabled=!0,document.querySelector("select#pattern-select").disabled=!0,t.disabled=!0,document.querySelectorAll(".visibility").forEach((e=>{e.classList.toggle("visible"),e.classList.toggle("hidden")}))):console.warn("L'input #start-date doit être renseigné avant de générer le calendrier.")})),document.querySelector("#reset").addEventListener("click",(()=>{localStorage.getItem("scheduleData")||(document.querySelector("select#pattern-select").disabled=!1,document.querySelector("input#start-date").disabled=!1)})),updateYearInTitle("current-year-stats"),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector(".stats-list");!function(){const t=localStorage.getItem("editableItems");if(t)try{const a=JSON.parse(t),n=e.querySelectorAll('[contenteditable="true"]');a.forEach(((e,t)=>{t<n.length&&(n[t].textContent=e.text)}))}catch(e){console.error("Erreur lors du chargement des données:",e)}}(),e.addEventListener("input",(t=>{"true"===t.target.getAttribute("contenteditable")&&function(){const t=Array.from(e.querySelectorAll("li")).map((e=>{const t=e.querySelector(".event-other"),a=e.querySelector('[contenteditable="true"]');return{code:t?t.textContent:"",text:a?a.textContent:""}})).filter((e=>""!==e.text.trim()));localStorage.setItem("editableItems",JSON.stringify(t))}()}))}));class Point{constructor(e,t){this.x=e,this.y=t}toSvgPath(){return`${this.x} ${this.y}`}static fromAngle(e){return new Point(Math.cos(e),Math.sin(e))}}class PieChart extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"open"}),this.shadow.innerHTML='\n      <style>\n        :host {\n          display: block;\n          position: relative;\n        }\n        svg {\n          width: 100%;\n          height: 100%;\n        }\n        path {\n          cursor: pointer;\n          transition: filter .3s;\n        }\n        path:hover,\n        path.active {\n          filter: brightness(0.8) sepia(1);\n        }\n        #labels-container {\n          position: absolute;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n          pointer-events: none;\n        }\n        .chart-label {\n          position: absolute;\n          padding: .2em .5em;\n          white-space: nowrap;\n          transform: translate(-50%, -50%);\n          background-color: var(--pie-chart-background-color-label, #fff);\n          color: var(--pie-chart-color-label, #000);\n          border-radius: 3px;\n          opacity: 0;\n          transition: opacity 0.5s ease;\n          pointer-events: none;\n        }\n        .chart-label.visible {\n          opacity: 1;\n        }\n      </style>\n      <svg viewBox="-1 -1 2 2">\n        <g mask="url(#graphMask)"></g>\n        <mask id="graphMask">\n          <rect fill="white" x="-1" y="-1" width="2" height="2"/>\n          <circle r="0.7" fill="black"/>\n        </mask>\n      </svg>\n      <div id="labels-container"></div>\n    '}static get observedAttributes(){return["data"]}attributeChangedCallback(e,t,a){"data"===e&&t!==a&&(this.initializeChart(),this.startAnimation())}connectedCallback(){this.initializeChart(),this.startAnimation()}parseChartData(){try{const e=["hsl(210, 100%, 50%)","hsl(210, 100%, 60%)","hsl(210, 100%, 70%)","hsl(210, 100%, 80%)","hsl(210, 100%, 90%)"];return JSON.parse(this.getAttribute("data")||"[]").map(((t,a)=>({value:parseFloat(t.value)||0,label:t.label||`Section ${a+1}`,color:t.color||e[a%e.length]})))}catch(e){return console.error("Invalid data format:",e),[]}}initializeChart(){this.chartData=this.parseChartData();const e=this.shadow.querySelector("svg"),t=e.querySelector("g"),a=e.querySelector("mask"),n=this.shadow.getElementById("labels-container"),r=this.getAttribute("donut")??"0.7",s=this.getAttribute("gap")??"0.04";t.innerHTML="",a.innerHTML=`\n      <rect fill="white" x="-1" y="-1" width="2" height="2"/>\n      <circle r="${r}" fill="black"/>\n    `,n.innerHTML="",this.paths=this.chartData.map(((e,a)=>{const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("fill",`var(--pie-chart-color-item-${e.label.replace(/ /,"").toLowerCase()}, ${e.color})`),n.addEventListener("mouseover",(()=>this.handlePathHover(a))),n.addEventListener("mouseout",(()=>this.handlePathOut(a))),t.appendChild(n),n})),this.lines=this.chartData.map((()=>{const e=document.createElementNS("http://www.w3.org/2000/svg","line");return e.setAttribute("stroke","#000"),e.setAttribute("stroke-width",s),e.setAttribute("x1","0"),e.setAttribute("y1","0"),a.appendChild(e),e})),this.labels=this.chartData.map(((e,t)=>{const a=document.createElement("div");return a.id=`label${t}`,a.className="chart-label",a.textContent=`${e.label} ${e.value}`,a.setAttribute("tabindex","0"),n.appendChild(a),a}))}startAnimation(){const e=Date.now(),t=()=>{const a=(Date.now()-e)/1e3;a<1?(this.draw(easeOutExpo(a)),window.requestAnimationFrame(t)):(this.draw(1),this.labels.forEach((e=>e.classList.add("visible"))))};window.requestAnimationFrame(t)}draw(e=1){const t=this.chartData.reduce(((e,t)=>e+t.value),0);let a=Math.PI/-2,n=new Point(0,-1);for(let r=0;r<this.chartData.length;r++){this.lines[r].setAttribute("x2",n.x),this.lines[r].setAttribute("y2",n.y);const s=this.chartData[r].value/t*e;1===e&&this.positionLabel(this.labels[r],a+s*Math.PI),a+=2*s*Math.PI-1e-7;const o=Point.fromAngle(a),l=s>.5?"1":"0";this.paths[r].setAttribute("d",`M 0 0 L ${n.toSvgPath()} A 1 1 0 ${l} 1 ${o.toSvgPath()} L 0 0`),n=o}}handlePathHover(e){this.dispatchEvent(new CustomEvent("sectionhover",{detail:e})),this.labels[e]?.classList.add("active")}handlePathOut(e){this.labels[e]?.classList.remove("active")}positionLabel(e,t){if(!e||void 0===t)return;const a=Point.fromAngle(t);let n=100*(.5*a.y+.5),r=100*(.5*a.x+.5);n=Math.min(100,Math.max(0,n)),r=Math.min(100,Math.max(0,r)),e.style.top=`${n}%`,e.style.left=`${r}%`}}customElements.define("pie-chart",PieChart);const addDays=(e,t)=>new Date(e.getTime()+24*t*60*60*1e3),easter=function(e){const t=e%19,a=Math.floor(e/100),n=e%100,r=(19*t+a-Math.floor(a/4)-Math.floor((Math.floor(a-(a+8)/25)+1)/3)+15)%30,s=(32+a%4*2+2*Math.floor(n/4)-r-n%4)%7,o=r+s-7*Math.floor((t+11*r+22*s)/451)+114,l=Math.floor(o/31);return new Date(e,l-1,o%31+1)},holidays=e=>({Armistice:new Date(e,10,11),Ascension:addDays(easter(e),39),Assumption:new Date(e,7,15),BastilleDay:new Date(e,6,14),LabourDay:new Date(e,4,1),NewYearSDay:new Date(e,0,1),PentecostMonday:addDays(easter(e),50),EasterMonday:addDays(easter(e),1),Christmas:new Date(e,11,25),AllSaintsDay:new Date(e,10,1),VictoryDay:new Date(e,4,8)}),alsaceHolidays=e=>({SaintStephenSDay:new Date(e,11,26),GoodFriday:addDays(easter(e),-2)});function publicHolidays(e,t={region:"mainland"}){return"alsace-moselle"===t.region?{...holidays(e),...alsaceHolidays(e)}:holidays(e)}const RotationPatterns={IDE:["J","J","S","J","J","R","R","S","S","J","M","F","R","R","S","J","M","M","R","S","S","J","M","R","R","T","M","M","M","R","J","S","S","R","R","J","J","S","J","M","R","R","S","S","J","J","M","R","R","F","S","S","J","J","R","R","M","M","M","R","S","S","S","T","R","R","S","J","M","M","R","J","J","S","S","R","R"],NightIDE:["N","N","R","R","N","N","N","R","R","N","N","R","R","R"],ASH:["M","M","M","M","R","S","S","S","S","R","R","M","M","M","M","R","S","S","S","R","R","T","M","M","M","M","R","R"]};function getSemesterRange(){const e=new Date,t=e.getFullYear(),a=e.getMonth()<6?0:6;return{startDate:new Date(0===a?t-1:t,0===a?6:0,1),endDate:new Date(t+1,0===a?6:12,0)}}function updateScheduleData(){if(!localStorage.getItem("scheduleData"))return void console.log("Aucune donnée existante pour scheduleData. Mise à jour ignorée.");const{startDate:e,endDate:t}=getSemesterRange(),a=JSON.parse(localStorage.getItem("scheduleData"))||{},n=[];let r=new Date(e);for(;r<=t;){const e=`${r.getFullYear()}-${r.getMonth()+1}`;n.push(e),r.setMonth(r.getMonth()+1)}for(const e of Object.keys(a))n.includes(e)||delete a[e];for(const e of n)if(!a[e]){const[t,n]=e.split("-").map(Number),r=new Date(t,n,0).getDate();a[e]={};for(let t=1;t<=r;t++)a[e][t]=["J","J"]}localStorage.setItem("scheduleData",JSON.stringify(a))}const CustomPatternManager={pattern:[],formatForDisplay(e){const t=(Array.isArray(e)?e.join(","):e).split(",").map((e=>e.trim())),a=[];for(let e=0;e<t.length;e+=7){const n=t.slice(e,e+7);a.push(n.join(", "))}return a.join(",\n")},cleanInput:e=>e.toUpperCase().replace(/[\s\n\r\t]/g,"").replace(/,+/g,",").replace(/^,/,"").replace(/,$/,""),validate(e){if(!e.trim())return!0;const t=["M","J","S","N","R","T","F"],a=e.split(",");for(let e of a)if(e=e.trim(),e&&!t.includes(e))return alert(`Caractère invalide détecté : "${e}"\nSeuls les caractères suivants sont autorisés : M, J, S, N, R, T, F`),!1;return!0},stringToPattern(e){return e.trim()?this.cleanInput(e).split(","):[]},load(){const e=localStorage.getItem("rotation-custom-pattern");return e&&(this.pattern=JSON.parse(e)),this.pattern.length>0?this.pattern:RotationPatterns.IDE},save(e){this.pattern=e,localStorage.setItem("rotation-custom-pattern",JSON.stringify(e))}},ScheduleClassManager={validClasses:new Set(["event-day","event-evening","event-morning","event-rest","event-extra-rest","event-holiday","event-night","event-leave","event-formation","event-overtime","event-stop","event-strike","event-union","event-other"]),classMap:new Map([["J","event-day"],["S","event-evening"],["M","event-morning"],["R","event-rest"],["T","event-extra-rest"],["F","event-holiday"],["N","event-night"],["C","event-leave"],["I","event-formation"],["H","event-overtime"],["A","event-stop"],["G","event-strike"],["D","event-union"],["E","event-other"],["L","event-other"],["O","event-other"],["P","event-other"],["Q","event-other"],["U","event-other"],["V","event-other"],["W","event-other"],["X","event-other"],["Y","event-other"],["Z","event-other"]]),getClass(e){return this.classMap.get(e)||null},isValidClass(e){return this.validClasses.has(e)}},CalendarManager={async generateSchedule(e,t){if(!e)return void alert("Veuillez entrer une date de début.");const a=new Date(e);a.setDate(a.getDate()-1);const n=document.getElementById("calendar");n.innerHTML="";const{startDate:r,endDate:s}=getSemesterRange(),o=document.createDocumentFragment();let l=new Date(r);for(;l<=s;){const e=new Date(l),n=e.getMonth()===(new Date).getMonth()&&e.getFullYear()===(new Date).getFullYear(),s=12*(e.getFullYear()-r.getFullYear())+e.getMonth()-r.getMonth();this.generateMonthTable(r,s,a,t,o,n),l.setMonth(l.getMonth()+1)}n.appendChild(o),localStorage.getItem("scheduleData")||await StorageManager.saveSchedule(n)},generateMonthTable(e,t,a,n,r,s){const o=document.createElement("div"),l=document.createElement("table");l.classList.add("table");const i=new Date,c=i.getMonth(),d=i.getFullYear(),u=new Date(e);u.setMonth(e.getMonth()+t);const h=u.getMonth(),g=u.getFullYear();s?l.classList.add("current"):g<d||g===d&&h<c?l.classList.add("past"):l.classList.add("future"),l.id=`month-${h+1}-${g}`,l.setAttribute("data-month-id",`${g}-${h+1}`);const m=document.createDocumentFragment();this.fillMonthTable(m,u,a,n),this.addTableCaption(l,u),l.appendChild(m),o.appendChild(l),r.appendChild(o),(g<d||g===d&&h<c)&&l.parentNode.classList.add("hidden")},addTableHeader(e,t){const a=document.createElement("tr");t.forEach((e=>{const t=document.createElement("th");t.textContent=e,a.appendChild(t)})),e.appendChild(a)},fillMonthTable(e,t,a,n){const r=new Date(t.getFullYear(),t.getMonth(),1),s=new Date(t.getFullYear(),t.getMonth()+1,0),o=(r.getDay()+6)%7,l=s.getDate(),i=publicHolidays(t.getFullYear()),c=document.createElement("thead"),d=document.createElement("tbody"),u=document.createElement("tr");["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"].forEach((e=>{const t=document.createElement("th");t.textContent=e,u.appendChild(t)})),c.appendChild(u),e.appendChild(c);const h=document.createDocumentFragment();let g=document.createElement("tr");for(let e=0;e<o;e++)g.appendChild(document.createElement("td"));for(let e=1;e<=l;e++){const r=new Date(t.getFullYear(),t.getMonth(),e),s=(Math.floor((r-a)/864e5)%n.length+n.length)%n.length,l=this.createDayCell(e,s,n,r),c=new Date;e===c.getDate()&&t.getMonth()===c.getMonth()&&t.getFullYear()===c.getFullYear()&&l.classList.add("current-day");Object.entries(i).filter((([e,t])=>t.toDateString()===r.toDateString())).length>0&&l.classList.add("public-holiday"),g.appendChild(l),(o+e)%7==0&&(h.appendChild(g),g=document.createElement("tr"))}if(g.children.length>0){for(;g.children.length<7;)g.appendChild(document.createElement("td"));h.appendChild(g)}d.appendChild(h),e.appendChild(d)},createDayCell(e,t,a,n){const r=document.createElement("td");r.setAttribute("data-day",e);if(0===n.getDay()&&r.classList.add("sunday"),null!==t&&a[t]){const e=a[t];r.textContent=e,r.setAttribute("data-original-value",e);const n=ScheduleClassManager.getClass(e);n&&r.classList.add(n)}return r},addTableCaption(e,t){const a=document.createElement("caption");a.textContent=t.toLocaleDateString("fr-FR",{month:"long",year:"numeric"}).replace(/^\p{CWU}/u,(e=>e.toLocaleUpperCase("fr-FR"))),e.prepend(a)}},StorageManager={scheduleData:{},async initSchedule(){try{const e=localStorage.getItem("scheduleData");this.scheduleData=e?JSON.parse(e):{}}catch(e){console.error("Erreur lors de l'initialisation des données:",e),this.scheduleData={}}},async saveSchedule(e){return new Promise((t=>{requestAnimationFrame((()=>{e.querySelectorAll('table[id^="month-"]').forEach((e=>{const t=e.getAttribute("data-month-id");e.querySelectorAll("td[data-day]").forEach((e=>{const a=e.getAttribute("data-day"),n=e.textContent.trim().toUpperCase();this.scheduleData[t]||(this.scheduleData[t]={});const[r,s]=this.scheduleData[t][a]||[n,n];n&&(this.scheduleData[t][a]=n!==r&&n!==s?[r,n]:[r,s])}))})),localStorage.setItem("scheduleData",JSON.stringify(this.scheduleData)),t()}))}))},async loadSchedule(e){try{return new Promise((e=>{requestAnimationFrame((()=>{const t=this.scheduleData;t?(Object.entries(t).forEach((([e,t])=>{let[a,n]=e.split("-");const r=`month-${n}-${a}`,s=document.getElementById(r);s&&Object.entries(t).forEach((([e,t])=>{const a=s.querySelector(`td[data-day="${e}"]`);if(a){const[e,n]=t,r=n||e,s=a.classList.contains("sunday"),o=a.classList.contains("current-day");Array.from(a.classList).forEach((e=>{(["modified","modified-spot"].includes(e)||e.startsWith("event-"))&&a.classList.remove(e)})),a.textContent=r;const l=ScheduleClassManager.getClass(r);l&&a.classList.add(l),n&&n!==e&&a.classList.add("modified"),s&&a.classList.add("sunday"),o&&a.classList.add("current-day")}}))})),e()):e()}))}))}catch(e){console.error("Erreur lors du chargement des données:",e)}}},EditManager={isEditingEnabled:!1,editableCells:[],toggleEditing(e,t){if(!document.querySelectorAll('table[id^="month-"]').length)return void alert("Veuillez d'abord générer le planning.");this.isEditingEnabled=!this.isEditingEnabled;const[a,n]=t.querySelectorAll("span");this.isEditingEnabled?(this.enableEditing(e),a.classList.add("hidden"),n.classList.remove("hidden"),t.classList.add("active")):(this.disableEditing(e),a.classList.remove("hidden"),n.classList.add("hidden"),t.classList.remove("active"))},toggleHistory(e){const t=document.querySelectorAll(".table.past"),a=document.querySelectorAll(":has(>.table.past)"),[n,r]=e.querySelectorAll("span");t.length?(a.forEach((e=>{e.classList.toggle("hidden")})),e.classList.toggle("active"),n.classList.toggle("hidden"),r.classList.toggle("hidden")):alert("Veuillez d'abord générer le planning.")},enableEditing(e){this.editableCells=Array.from(e.querySelectorAll("td[data-day]")),this.editableCells.forEach((e=>{e.style.cursor="pointer",e.setAttribute("tabindex","0"),e.setAttribute("contenteditable","true")}))},disableEditing(e){this.editableCells.forEach((e=>{e.style.cursor="",e.removeAttribute("tabindex"),e.removeAttribute("contenteditable")})),this.editableCells=[],StorageManager.saveSchedule(e)},handleCellClick(e,t){if(!this.isEditingEnabled)return;const a=e.target.closest("td[data-day]");if(a){a.focus();const e=document.createRange();e.selectNodeContents(a);const t=window.getSelection();t.removeAllRanges(),t.addRange(e),a.setAttribute("data-current-value",a.textContent.trim())}},handleCellInput(e,t){if(!this.isEditingEnabled)return;const a=e.target.closest("td[data-day]");if(!a)return;const n=a.textContent.trim().toUpperCase();n.length>1?a.textContent=n.charAt(0):a.textContent=n,n!==a.getAttribute("data-original-value")&&a.classList.add("modified")},handleCellBlur(e,t){if(!this.isEditingEnabled)return;const a=e.target.closest("td[data-day]");if(!a)return;const n=a.textContent.trim().toUpperCase(),r=a.getAttribute("data-day"),s=a.closest("table")?.getAttribute("data-month-id"),[o,l]=StorageManager.scheduleData[s]?.[r]||[null,null];if(!n)return void(a.textContent=l||o);if(!["M","J","S","N","H","R","T","F","C","I","A","G","D","E","L","O","P","Q","U","V","W","X","Y","Z"].includes(n))return void(a.textContent=l||o);a.textContent=n;const i=ScheduleClassManager.getClass(n);i&&(Array.from(a.classList).forEach((e=>{(e.startsWith("event-")||"modified"===e||"modified-spot"===e)&&a.classList.remove(e)})),a.classList.add(i)),n!==o?a.classList.add("modified-spot"):a.classList.remove("modified-spot"),n===o?(a.classList.remove("modified"),StorageManager.scheduleData[s][r]=[o,o]):(a.classList.add("modified"),StorageManager.scheduleData[s][r]=[o,n]),StorageManager.saveSchedule(t)}};function scrollToTop(){const e=document.querySelector(".footer"),t=document.createElement("button");t.type="button",t.classList.add("scroll-top","fade-out"),t.setAttribute("aria-label","Scroll to top"),t.insertAdjacentHTML("beforeEnd",'<svg focusable="false"><use href="./sprites/util.svg#arrow_upward"></use></svg>'),e.appendChild(t),window.addEventListener("scroll",(function(){const e=window.innerHeight/2;window.scrollY>e?(t.classList.remove("fade-out"),t.classList.add("fade-in")):(t.classList.add("fade-out"),t.classList.remove("fade-in"))})),t.addEventListener("click",(function(){window.scrollTo({top:0})}),!1)}function getCurrentYear(){return(new Date).getFullYear().toString()}function isCurrentYearMonth(e){return e.split("-")[0]===getCurrentYear()}function filterCurrentYearData(e){const t={};for(const a in e)isCurrentYearMonth(a)&&(t[a]=e[a]);return t}function calculateLetterStats(e){const t={},a=filterCurrentYearData(e);for(const e in a)for(const n in a[e]){const r=a[e][n],s=void 0!==r[1]?r[1]:r[0];t[s]?t[s]++:t[s]=1}return t}function calculateHolidayAndSundayWork(e){const t=publicHolidays(getCurrentYear());let a=0;const n=getCurrentYear(),r=Object.values(t).map((e=>{const t=new Date(e);return t.setDate(t.getDate()+1),t.toISOString().split("T")[0]})),s=Object.entries(e).filter((([e])=>e.startsWith(n))).reduce(((e,[t,a])=>(e[t]=a,e)),{});return Object.entries(s).forEach((([e,t])=>{const s=e.split("-")[1];Object.entries(t).forEach((([e,t])=>{const o=t[1];if(!o)return;const l=`${n}-${s.padStart(2,"0")}-${e.padStart(2,"0")}`,i=0===new Date(l).getDay();(r.includes(l)||i)&&["M","J","S"].includes(o)&&a++}))})),a}function rearrangeStats(e){const t=Object.entries(e).sort(((e,t)=>t[1]-e[1])),a=Math.ceil(t.length/2),n=t.slice(0,a),r=t.slice(a),s=[],o=Math.max(n.length,r.length);for(let e=0;e<o;e++)e<n.length&&s.push(n[e]),e<r.length&&s.push(r[e]);return s}function updateLetterStats(){const e=JSON.parse(localStorage.getItem("scheduleData"));if(e){const t=rearrangeStats(calculateLetterStats(e)).map((([e,t])=>`{"value": ${t}, "label": "${e}"}`)).join(","),a=document.getElementById("stats"),n=calculateHolidayAndSundayWork(e);a.innerHTML=`\n     <pie-chart data='[${t}]' gap="0" donut="0.7"></pie-chart>\n     <p>Dimanches et jours fériés travaillés&nbsp;: <strong>${n}</strong></p>\n   `}}function initializeStats(){const e=((e,t)=>{let a;return(...n)=>{clearTimeout(a),a=setTimeout((()=>e.apply(this,n)),t)}})(updateLetterStats,500),t=new MutationObserver((t=>{t.some((e=>"childList"===e.type||"attributes"===e.type&&e.target.closest(".table")))&&Promise.resolve().then(e)})),a={childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","data-*"]},n=document.getElementById("calendar");n&&t.observe(n,a),updateLetterStats();const r=document.getElementById("generate-schedule");r&&r.addEventListener("click",e)}document.addEventListener("DOMContentLoaded",(async()=>{await StorageManager.initSchedule(),updateScheduleData();const e=document.getElementById("calendar"),t=document.getElementById("contenteditable"),a=document.getElementById("history"),n=document.getElementById("pattern-select"),r=document.getElementById("start-date"),s=document.getElementById("custom-pattern"),o=document.getElementById("save-custom-pattern"),l=document.getElementById("generate-schedule"),i=document.getElementById("reset");function c(e){switch(e){case"NightIDE":return RotationPatterns.NightIDE;case"ASH":return RotationPatterns.ASH;case"CUSTOM":return CustomPatternManager.load();default:return RotationPatterns.IDE}}function d(e){s.value=CustomPatternManager.formatForDisplay(e)}function u(){return CustomPatternManager.stringToPattern(s.value)}const h=localStorage.getItem("startDate");h&&(await CalendarManager.generateSchedule(h,u()),await StorageManager.loadSchedule(e));d(c(n.value)),t&&t.addEventListener("click",(()=>{EditManager.toggleEditing(e,t)})),a&&a.addEventListener("click",(()=>{EditManager.toggleHistory(a)})),e&&(e.addEventListener("click",(t=>{EditManager.handleCellClick(t,e)})),e.addEventListener("input",(t=>{EditManager.handleCellInput(t,e)})),e.addEventListener("blur",(t=>{EditManager.handleCellBlur(t,e)}),!0)),n.addEventListener("change",(function(){d(c(this.value)),localStorage.setItem("patternSelect",this.value)})),o.addEventListener("click",(function(){const e=CustomPatternManager.cleanInput(s.value);if(CustomPatternManager.validate(e)){s.value=CustomPatternManager.formatForDisplay(e);const t=CustomPatternManager.stringToPattern(e);CustomPatternManager.save(t)}else{d(CustomPatternManager.pattern.length>0?CustomPatternManager.pattern:c(n.value))}})),r.addEventListener("blur",(function(){if(!this.value)return;const e=new Date(this.value);if(isNaN(e.getTime()))return alert("Date invalide. Veuillez réessayer."),void(this.value="");1!==e.getDay()?(alert("Veuillez sélectionner un lundi."),this.value=""):localStorage.setItem("startDate",this.value)})),l.addEventListener("click",(async()=>{await CalendarManager.generateSchedule(r.value,u()),await StorageManager.loadSchedule(e)})),i&&i.addEventListener("click",(()=>{window.confirm("Êtes-vous sûr de vouloir effacer toutes vos données sauvegardées ? Cette action est irréversible.")&&(localStorage.clear(),console.log("Le localStorage a été réinitialisé."),location.reload(),console.log("Rechargement de la page."))})),await async function(){CustomPatternManager.load();const t=localStorage.getItem("patternSelect"),a=localStorage.getItem("startDate");t&&(n.value=t),a&&(r.value=a,await CalendarManager.generateSchedule(a,u()),await StorageManager.loadSchedule(e)),d(c(n.value))}()})),document.addEventListener("DOMContentLoaded",(()=>{scrollToTop()})),document.addEventListener("DOMContentLoaded",(()=>{setTimeout((()=>{initializeStats()}),100)}));const tabs=()=>{const e=window.location.pathname,t=`${(e.substring(0,e.lastIndexOf("."))||e).replace(/[\W_]/gi,"")||"index".toLowerCase()}TabsPanel`,a=e=>{const a=e.id.match(/\d+$/i)[0],s=document.getElementById(e.getAttribute("aria-controls"));r(e),localStorage.setItem(`${t}${a}`,"open"),s.ariaHidden="false";e.parentElement.parentElement.querySelectorAll(".tab-panel").forEach((e=>{e!==s&&(e.ariaHidden="true")})),n(e)},n=e=>{[...e.parentElement.children].forEach((a=>{if(a!==e){s(a);const e=a.id.match(/\d+$/i)[0];localStorage.setItem(`${t}${e}`,"close")}}))},r=e=>{e.disabled=!0,e.ariaSelected="true",e.ariaExpanded="true"},s=e=>{e.disabled=!1,e.ariaSelected="false",e.ariaExpanded="false"};document.querySelectorAll(".tabs").forEach(((e,t)=>{e.id=`tabs-${t}`,e.insertAdjacentHTML("afterbegin",'<div role="tablist" aria-label="Entertainment" class="tab-list"></div>')})),document.querySelectorAll(".tabs > * > summary").forEach(((e,a)=>{const n="open"===localStorage.getItem(`${t}${a}`),r=e.innerHTML;e.parentElement.parentElement.firstElementChild.appendChild(e),e.outerHTML=`<button id="tabsummary-${a}" type="button" role="tab" class="tab-summary" aria-controls="tab-panel-${a}" aria-selected="${n}" aria-expanded="${n}" ${n?"disabled":""}>${r}</button>`})),document.querySelectorAll(".tab-summary:first-child").forEach((e=>r(e))),document.querySelectorAll(".tabs > details > *").forEach(((e,t)=>{e.id=`tab-panel-${t}`,e.classList.add("tab-panel"),e.role="tabpanel",e.setAttribute("aria-labelledby",`tabsummary-${t}`),e.ariaHidden="true",e.parentElement.parentElement.appendChild(e),e.parentElement.children[1].remove()})),document.querySelectorAll(".tabs > :nth-child(2)").forEach((e=>e.ariaHidden="false")),document.querySelectorAll(".tab-summary").forEach((e=>{e.addEventListener("click",(()=>a(e)))})),document.querySelectorAll(".tab-summary").forEach((e=>{const a=e.id.match(/\d+$/i);if(!a)return;const n=a[0],o=localStorage.getItem(`${t}${n}`);if(!o)return;const l=`tab-panel-${n}`,i=document.getElementById(l);i&&i.setAttribute("aria-hidden","open"===o?"false":"true"),("open"===o?r:s)(e)}))};window.addEventListener("DOMContentLoaded",tabs());