"use strict";const mediaPlayer=()=>{const e=document.querySelectorAll(".media"),a=e=>{e.insertAdjacentHTML("afterend",'\n  <div class="media-player">\n    <button class="media-play-pause" aria-label="play/pause">\n      <svg focusable="false">\n        <use href="/sprites/player.svg#play"></use>\n      </svg>\n      <svg focusable="false">\n        <use href="/sprites/player.svg#play-disabled"></use>\n      </svg>\n      <svg focusable="false">\n        <use href="/sprites/player.svg#pause"></use>\n      </svg>\n    </button>\n    <div class="media-tags">\n      <output class="media-subtitle-langage"></output>\n      <output class="media-playback-rate"></output>\n    </div>\n    <div class="media-time">\n      <output class="media-current-time"aria-label="current time">0:00</output>&nbsp;/&nbsp;<output class="media-duration"aria-label="duration">0:00</output>\n    </div>\n    <input type="range" class="media-progress-bar" aria-label="progress bar" min="0" max="100" step="1" value="0">\n    <div class="media-extend-volume">\n      <input type="range" class="media-volume-bar" aria-label="volume bar" min="0" max="1" step=".1" value=".5">\n      <button class="media-mute" aria-label="mute">\n        <svg focusable="false">\n          <use href="/sprites/player.svg#volume-up"></use>\n        </svg>\n        <svg focusable="false">\n          <use href="/sprites/player.svg#volume-off"></use>\n        </svg>\n      </button>\n    </div>\n    <button class="media-fullscreen" aria-label="fullscreen">\n      <svg focusable="false">\n        <use href="/sprites/player.svg#fullscreen"></use>\n      </svg>\n    </button>\n    <button class="media-menu" aria-label="menu">\n      <svg focusable="false">\n        <use href="/sprites/player.svg#menu"></use>\n      </svg>\n    </button>\n    <div class="media-extend-menu">\n      <button class="media-next-reading" aria-label="next reading mode">\n        <svg focusable="false">\n          <use href="/sprites/player.svg#move-down"></use>\n        </svg>\n      </button>\n      <button class="media-subtitles" aria-label="subtitles">\n        <svg focusable="false">\n          <use href="/sprites/player.svg#subtitles"></use>\n        </svg>\n        \x3c!--\n        <svg focusable="false">\n          <use href="/sprites/player.svg#subtitles-off"></use>\n        </svg>\n        --\x3e\n      </button>\n      <button class="media-picture-in-picture" aria-label="picture in picture">\n        <svg focusable="false">\n          <use href="/sprites/player.svg#picture-in-picture"></use>\n        </svg>\n        <svg focusable="false">\n          <use href="/sprites/player.svg#picture-in-picture-alt"></use>\n        </svg>\n      </button>\n      <button class="media-slow-motion" aria-label="slow motion">\n        <svg focusable="false">\n          <use href="/sprites/player.svg#slow-motion"></use>\n        </svg>\n      </button>\n      <button class="media-leap-rewind" aria-label="leap rewind">\n        <svg focusable="false">\n          <use href="/sprites/player.svg#rewind-10"></use>\n        </svg>\n      </button>\n      <button class="media-leap-forward" aria-label="leap forward">\n        <svg focusable="false">\n          <use href="/sprites/player.svg#forward-10"></use>\n        </svg>\n      </button>\n      \x3c!--\n      <button class="media-fast-rewind" aria-label="fast rewind">\n        <svg focusable="false">\n          <use href="/sprites/player.svg#fast-rewind"></use>\n        </svg>\n      </button>\n      <button class="media-fast-forward" aria-label="fast forward">\n        <svg focusable="false">\n          <use href="/sprites/player.svg#fast-forward"></use>\n        </svg>\n      </button>\n      --\x3e\n      <button class="media-stop" aria-label="stop">\n        <svg focusable="false">\n          <use href="/sprites/player.svg#stop"></use>\n        </svg>\n      </button>\n      <button class="media-replay" aria-label="replay">\n        <svg focusable="false">\n          <use href="/sprites/player.svg#replay"></use>\n        </svg>\n      </button>\n    </div>\n  </div>\n  '),s(e)},t=e=>{let a=Math.floor(e/3600).toString(),t=Math.floor(e%3600/60).toString(),s=Math.floor(e%60).toString().padStart(2,"0");return"0"===a&&(a=null),isNaN(a)&&(a=null),isNaN(t)&&(t="0"),isNaN(s)&&(s="00"),[a,t,s].filter(Boolean).join(":")},s=e=>{const a=e.nextElementSibling,s=a.querySelector(".media-time"),r=a.querySelector(".media-duration"),n=a.querySelector(".media-progress-bar"),l=a.querySelector(".media-menu"),i=a.querySelector(".media-extend-menu");e.readyState>=1?r.value=t(e.duration):e.addEventListener("loadedmetadata",()=>r.value=t(e.duration)),["loadeddata","loadedmetadata","click","play"].forEach(a=>{e.addEventListener(a,()=>{e.duration===1/0&&(s.innerHTML="Lecture en continu",s.style.marginRight="auto",n.remove(),l.remove(),i.remove())})})},r=(e,a,s)=>{setInterval(function(){const r=Math.floor(e.currentTime/e.duration*1e3)/10;a.value=t(e.currentTime),s.value=r,s.style.setProperty("--position",`${r}%`)},50)},n=(e,a)=>e?a.classList.add("active"):a.classList.remove("active"),l=e=>e.paused?e.play():e.pause(),i=e=>`cc: ${e}`,u=(e,a=!1)=>{const t=e.querySelector(".media-extend-menu");a&&t.classList.toggle("active"),document.querySelectorAll(".media-player").forEach(a=>{if(a!==e){const e=a.querySelector(".media-menu"),t=a.querySelector(".media-extend-menu");e&&e.classList.remove("active"),t&&t.classList.remove("active")}})},o=(e,a)=>{if(a){const t=a.querySelectorAll(".media")||"";return t[[...t].indexOf(e)+1]||t[0]||""}},d=(e,a)=>{if(a){const t=a.querySelectorAll(".media")||"";return t[[...t].indexOf(e)+2]||t[0]||""}},c=(e,a,t,s)=>{if((e=a).error)return console.log(e.error.message),c(e,o(e,s),d(e,s),s);const i=e.nextElementSibling,u=i.querySelector(".media-current-time"),m=i.querySelector(".media-play-pause"),p=i.querySelector(".media-stop"),v=i.querySelector(".media-progress-bar");l(e),r(e,u,v),n(!e.paused,m),n(e.paused&&0===e.currentTime,p),e.paused&&0===e.currentTime?p.disabled=!0:p.disabled=!1},m=a=>{const t=a.nextElementSibling,s=a.textTracks,m=t.querySelector(".media-play-pause"),p=t.querySelector(".media-playback-rate"),v=t.querySelector(".media-subtitle-langage"),b=t.querySelector(".media-current-time"),g=t.querySelector(".media-progress-bar"),f=t.querySelector(".media-volume-bar"),y=t.querySelector(".media-mute"),S=t.querySelector(".media-fullscreen"),L=t.querySelector(".media-menu"),E=t.querySelector(".media-next-reading"),h=t.querySelector(".media-picture-in-picture"),q=t.querySelector(".media-slow-motion"),x=t.querySelector(".media-leap-rewind"),k=t.querySelector(".media-leap-forward"),w=t.querySelector(".media-stop"),R=t.querySelector(".media-replay"),P=t.querySelector(".media-subtitles"),T=a.closest(".media-relationship"),A=o(a,T),M=d(a,T);"AUDIO"!==a.tagName&&document.fullscreenEnabled||S.remove(),"AUDIO"!==a.tagName&&document.pictureInPictureEnabled||h.remove(),a.textTracks[0]||P.remove(),T||E.remove();g.value="0",g.style.setProperty("--position","0%"),g.style.setProperty("--position-buffer","0%"),f.value=".5",f.style.setProperty("--position","50%");T&&a.addEventListener("canplay",()=>n("true"===T.dataset.nextReading,a.nextElementSibling.querySelector(".media-next-reading"))),["loadeddata","progress"].forEach(e=>{a.addEventListener(e,()=>{a.onprogress=(()=>g.style.setProperty("--position-buffer",`${Math.floor(a.buffered.end(a.buffered.length-1)/a.duration*100)}%`))})}),a.addEventListener("waiting",()=>t.classList.add("waiting")),a.addEventListener("canplay",()=>t.classList.remove("waiting")),document.addEventListener("play",a=>{e.forEach(e=>e!==a.target&&e.pause())},!0),["click","play","pause","ended","input"].forEach(e=>{document.addEventListener(e,()=>{n(!a.paused,m),n(a.muted||0===a.volume,y),n(a.paused&&0===a.currentTime,w),n(a.loop,R),a.paused&&0===a.currentTime?w.disabled=!0:w.disabled=!1})}),a.addEventListener("ended",()=>{m.classList.remove("active"),T&&"true"===T.dataset.nextReading&&a.play&&c(a,A,M,T),T&&T.dataset.nextReading&&A&&(M.preload="auto")}),a.addEventListener("pause",()=>m.classList.remove("active")),m.addEventListener("click",()=>{l(a),r(a,b,g),u(t,!1),T&&T.dataset.nextReading&&A&&(A.preload="auto")}),y.addEventListener("click",()=>(e=>e.muted=!e.muted)(a)),g.addEventListener("input",()=>{a.currentTime=g.value/g.max*a.duration,r(a,b,g)}),f.addEventListener("input",()=>{const e=f.value/f.max;a.volume=e,f.style.setProperty("--position",`${100*e}%`)}),L.addEventListener("click",()=>{u(t,!0),L.classList.toggle("active");try{document.querySelector("body:has(*)")}catch(e){console.log('Solution de repli JS pour ".media-extend-menu"');const a=t.querySelector(".media-extend-menu"),s=a.querySelectorAll("button").length;let r=s;s>12?r=6:s>6&&(r=Math.ceil(s/2)),a.style.setProperty("--mem",r),console.log(r)}}),E.addEventListener("click",()=>{"false"===T.dataset.nextReading?T.dataset.nextReading="true":T.dataset.nextReading="false",T.querySelectorAll(".media").forEach(e=>{"true"===T.dataset.nextReading&&(e.loop=!1),n("true"===T.dataset.nextReading,e.nextElementSibling.querySelector(".media-next-reading"))})});let I=-1;P.addEventListener("click",()=>{(I+=1)>1&&(s[I-1].mode="disabled"),I<s.length?("showing"===s[I].mode&&(I+=1),((e,a,t)=>{e[a-1]&&(e[a-1].mode="disabled"),e[a].mode="showing";const s=i(e[a].language);t.value=s})(s,I,v),n("showing"===s[I].mode,P),n("showing"===s[I].mode,v)):(I=-1,v.value="",P.classList.remove("active"),v.classList.remove("active"))});for(let e of s)if("showing"===e.mode){P.classList.add("active"),v.classList.add("active"),v.value=i(e.language);break}"VIDEO"===a.tagName&&document.fullscreenEnabled&&S.addEventListener("click",()=>(e=>e.requestFullscreen())(a)),document.addEventListener("fullscreenchange",()=>S.classList.toggle("active")),h.addEventListener("click",()=>{(e=>{document.pictureInPictureElement?document.exitPictureInPicture():document.pictureInPictureEnabled&&e.requestPictureInPicture()})(a),n(!document.pictureInPictureElement,h)}),q.addEventListener("click",()=>{((e,a)=>{switch(e.playbackRate){case 1:e.playbackRate=.5;break;case.5:e.playbackRate=.25;break;case.25:e.playbackRate=.1;break;case.1:e.playbackRate=4;break;case 4:e.playbackRate=2;break;case 2:e.playbackRate=1.5;break;default:e.playbackRate=1}a.innerHTML=`x${e.playbackRate}`})(a,p),n(1!==a.playbackRate,q),1!==a.playbackRate&&p.classList.add("active")}),x.addEventListener("click",()=>{(e=>e.currentTime-=10)(a),r(a,b,g)}),k.addEventListener("click",()=>{(e=>e.currentTime+=10)(a),r(a,b,g)}),w.addEventListener("click",()=>{(e=>{e.pause(),e.currentTime=0})(a),r(a,b,g)}),R.addEventListener("click",()=>(e=>e.loop=!e.loop)(a))},p=e=>{const a=e.nextElementSibling,t=a.querySelector(".media-time");e.src=e.currentSrc,e.addEventListener("error",()=>{a.setAttribute("inert",""),a.querySelectorAll("button, input").forEach(e=>e.disabled=!0),e.classList.add("error"),a.classList.add("error"),console.error(e.error.message),t.innerHTML="Erreur de lecture",e.poster=""},!0)};let v=0;for(const t of e)v++,t.id="media-"+v,t.removeAttribute("controls"),a(t),m(t),p(t)};window.addEventListener("DOMContentLoaded",mediaPlayer());